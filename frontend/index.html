<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Cobranzas - FyJ Desarrollos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <div class="container-fluid d-flex align-items-center justify-content-between">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="logo.png" alt="Logo FyJ" width="42" height="42" class="me-2">
    </a>
    <span id="rolActual" class="text-muted small"></span>
  </div>
</nav>

<!-- Contenido principal -->
<div class="container my-4">

  <!-- Bienvenida -->
  <section id="view-bienvenida">
    <h2 class="mb-4 text-center">Bienvenido</h2>
    <div class="d-flex gap-3 justify-content-center">
      <button class="btn btn-primary" onclick="irLogin('admin')">Ingresar como Administrador</button>
      <button class="btn btn-outline-dark" onclick="irLogin('empleado')">Ingresar como Empleado</button>
    </div>
  </section>

  <!-- Login -->
  <section id="view-login" class="d-none">
    <h3 id="login-titulo" class="mb-3">Iniciar Sesión</h3>
    <form id="form-login" class="col-md-4 mx-auto">
      <input type="password" class="form-control mb-3" placeholder="Contraseña" name="password" required>
      <div class="d-grid gap-2">
        <button class="btn btn-primary" type="submit">Ingresar</button>
        <button class="btn btn-link" type="button" onclick="mostrar('view-bienvenida')">Volver</button>
      </div>
    </form>
  </section>

  <!-- Menú Admin -->
  <section id="view-menu-admin" class="d-none text-center">
    <h3 class="mb-4">Menú del Administrador</h3>
    <div class="d-grid gap-3 col-md-6 mx-auto">
      <button class="btn btn-primary" onclick="mostrar('view-alta-cliente')">Registrar Nuevo Cliente</button>
      <button class="btn btn-primary" onclick="mostrar('view-visualizar')">Cobro Cuotas</button>
      <button class="btn btn-primary" onclick="mostrar('view-incremento')">Aplicar Incremento Trimestral</button>
      <button class="btn btn-primary" onclick="mostrar('view-informe')">Generar Informe de Pagos</button>
      <button class="btn btn-outline-danger" onclick="logout()">Cerrar Sesión</button>
    </div>
  </section>

  <!-- Menú Empleado -->
  <section id="view-menu-empleado" class="d-none text-center">
    <h3 class="mb-4">Menú del Empleado</h3>
    <div class="d-grid gap-3 col-md-6 mx-auto">
      <button class="btn btn-primary" onclick="mostrar('view-visualizar')">Visualizar Cliente</button>
      <button class="btn btn-outline-danger" onclick="logout()">Cerrar Sesión</button>
    </div>
  </section>

  <!-- Alta Cliente -->
  <section id="view-alta-cliente" class="d-none">
    <h4 class="mb-3">Registrar Nuevo Cliente</h4>
    <form id="form-cliente" class="row g-3">
      <div class="col-md-6"><input class="form-control" name="nombre" placeholder="Nombre" required></div>
      <div class="col-md-6"><input class="form-control" name="apellido" placeholder="Apellido" required></div>
      <div class="col-md-6"><input class="form-control" name="documento" placeholder="Documento" required></div>
      <div class="col-md-6"><input class="form-control" name="numero_lote" placeholder="Número de Lote" required></div>
      <div class="col-md-6"><input class="form-control" name="manzana" placeholder="Manzana" required></div>
      <div class="col-md-6"><input type="tel" class="form-control" name="telefono" placeholder="Teléfono" required></div>
      <div class="col-md-6"><input type="email" class="form-control" name="email" placeholder="Email" required></div>

      <div class="col-md-6">
        <select class="form-select" name="barrio" required>
          <option value="">Barrio</option>
          <option>Los Eucaliptos</option>
          <option>Los Cardos</option>
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label">Mes Inicio Cobro</label>
        <input type="month" class="form-control" name="fecha_inicio_mes" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Fecha de Firma</label>
        <input type="date" class="form-control" name="fecha_firma" required>
      </div>

      <div class="col-md-3">
        <input type="number" class="form-control" name="cuotas" placeholder="Cuotas (1..64)" min="1" max="64" required>
      </div>
      <div class="col-md-3">
        <input type="number" class="form-control" name="monto_cuota" placeholder="Monto cuota" step="0.01" required>
      </div>
      <div class="col-md-3">
        <select class="form-select" name="moneda" required>
          <option value="Pesos">Pesos</option>
          <option value="Dólares">Dólares</option>
        </select>
      </div>

      <!-- Titulares -->
      <div class="col-md-6"><input class="form-control" name="titular1" placeholder="Titular 1" required></div>
      <div class="col-md-6"><input class="form-control" name="titular2" placeholder="Titular 2 (opcional)"></div>

      <!-- Etapa (solo Los Eucaliptos) -->
      <div class="col-md-6" id="etapa-container" style="display:none;">
        <select class="form-select" name="etapa" id="etapa-select">
          <option value="">Etapa</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </div>

      <div class="col-12 d-flex justify-content-between">
        <button class="btn btn-success" type="submit">Guardar</button>
        <button class="btn btn-link" type="button" onclick="volverMenu()">Volver</button>
      </div>
    </form>
  </section>


  <!-- Visualizar Cliente -->
  <section id="view-visualizar" class="d-none">
    <h4 class="mb-3">Buscar Cliente</h4>
    <div class="input-group mb-3">
      <span class="input-group-text">Documento</span>
      <input id="doc-busqueda" class="form-control" placeholder="DNI">
      <button class="btn btn-primary" onclick="buscarCliente()">Buscar</button>
      <button class="btn btn-link" onclick="volverMenu()">Volver</button>
    </div>

    <pre id="info-cliente" class="p-3 bg-light border rounded" style="white-space:pre-wrap"></pre>

    <table class="table table-sm table-striped align-middle">
      <thead>
        <tr>
          <th>Cuota</th>
          <th>Fecha Estimada</th>
          <th>Monto</th>
          <th>Pagado</th>
          <th>Fecha Pago</th>
          <th>Saldo a Cuenta</th>
          <th>Pago Manual</th>
          <th>Observaciones</th>
        </tr>
      </thead>
      <tbody id="tabla-cuotas"></tbody>
    </table>
    <small class="text-muted">
      Doble click sobre una fila para marcar / desmarcar pago. Los campos son editables.
    </small>
  </section>

  <!-- Incremento -->
  <section id="view-incremento" class="d-none">
    <h4 class="mb-3">Aplicar Incremento Trimestral</h4>
    <div class="row g-2 align-items-end">
      <div class="col-md-4">
        <label class="form-label">Mes</label>
        <input type="month" id="mes-incremento" class="form-control">
      </div>
      <div class="col-md-4">
        <label class="form-label">Porcentaje (%)</label>
        <input id="porc-incremento" type="number" class="form-control" placeholder="Ej: 10" min="0.01" step="0.01">
      </div>
      <div class="col-md-4">
        <button class="btn btn-success" onclick="aplicarIncrementoGlobal()">Aplicar</button>
        <button class="btn btn-link" onclick="volverMenu()">Volver</button>
      </div>
    </div>
    <div id="inc-resultado" class="mt-3"></div>
  </section>

  <!-- Informe -->
  <section id="view-informe" class="d-none">
    <h4 class="mb-3">Informe de Pagos</h4>
    <div class="d-flex gap-2 mb-3 flex-wrap">
      <input type="month" id="mes-informe" class="form-control" style="max-width:200px">
      <input type="date" id="dia-informe" class="form-control" style="max-width:200px">
      <button class="btn btn-outline-success" onclick="cargarPagaron()">Clientes que PAGARON</button>
      <button class="btn btn-outline-secondary" onclick="cargarNoPagaron()">Clientes que NO PAGARON</button>
      <button class="btn btn-dark" onclick="exportarCSV()">Exportar a CSV</button>
      <button class="btn btn-link" onclick="volverMenu()">Volver</button>
    </div>
    <ul id="lista-informe" class="list-group"></ul>
    <div id="total-informe" class="mt-3 fw-bold text-end text-primary"></div>
  </section>
</div>

<footer class="footer mt-5">
  <div class="container text-center py-3">
    <img src="logo.png" width="36" class="mb-2" alt="logo">
    <p class="mb-1"><strong>FyJ Desarrollos SRL</strong></p>
    <p class="small text-muted">© 2025 FyJ Desarrollos - Todos los derechos reservados</p>
  </div>
</footer>

<script src="app.js"></script>
</body>
</html>
